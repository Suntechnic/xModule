# Модуль-каркас

## Создание своего модуля

Перейдите в меню Настройки → Инструменты → [Создание модуля](/bitrix/admin/x_module_modules.php), - заполните поля во вкладке Создание модуля и нажмите Создать.

### Вы так же можете создать модуль вручную: 

1. Скоприуйте модуль в новое местоположение
2. Исправьте имя класса в файле install/index.php, в том числе в тексте комментариев!
3. Заменить константы описания модуля в lang/ru/lib/module.php
4. Исправьте неймспейс в файле модуля: lib/module.php либо полностью замените содержимое lib/module.php унаследовав его от \X\Module\Module, в последнем случае необходимо расскоментировать стрку \Bitrix\Main\Loader::includeModule('x.module') в файле include.php
5. Удалите лишние файлы, в том числе все файлы _example_* 

## Файлы настроек модуля

Файлы настрое модуля расположены в папке модуля и начинаются с точки. Файлы должны возвращать архив при подключении.

### .settings.php

Штатный файл для конфигурации контроллеров и сервисов модуля. Подробнее смотрите в документации Bitrix Framework.


### .env.php

Файл определяющие окружение модуля. Должен возвращать массив со следующими ключами:
```php
return [
        'PATH_ABS' => абсолютный путь к папке модуля
        'PATH' => путь к папке модуля от корня сайта (/local/modules/x.moduel)
        'DIR' => имя папки модуля (x.moduel)
        'ID' => id модуля (x.moduel)
        'SPACE' => пространство модуля, то же что и код партнера (x)
        'UID' => индентификатор модуля (module)
        'CODE' =>  код модуля, то же что идентификатор в верхнем регистра (MODULE)
        'NS' => пространство имен модуля (\X\Module)
        'CLASS' => класс модуля (\X\Module\Module)
    ];
```

### .agents.php

Файл конфигурации агентов. Должен возвращать список где для каждого агент опредён массив конфигурации:
```php
return [
        [
                'title' => название агента (Итератор),
                'name' => функция агента (\X\Module\Agent::Iterator();),
                'period' => периодический агент (N|Y),
                'interval' => интервал запуска в секундах (3600)
            ]
    ];
```
Все агенты описанные в этом файле будут автоматичеки зарегистрированы при установке модуля, а так же выведены на вкладке Агенты, настрое модуля, для запуска вручную.


### .config.php

Параметры конфигурации модуля недоступные для изменения через интерфей административной части сайта.
```php
return [
        'optionspage' => [ На странице настроек модуля:
                'showlogs' => Показывать вкладку с логами (true)
                'showagents' => Показывать вкладку с агентами (true)
                'showtechoptins' => Показывать технические опции модуля, не описанные в .options.php (true)
                'showreadme' => Показывать содержимое файла README.md (true)
                'showchangelog' => Показывать содержимое файла CHANGELOG.md (true)
            ]
    ];
```


### .handlers.php

Файл с описанием перехватчиков событий которые необходимо зарегистрировать при установке модуля:
```php
return [
        [
                'module' => модуль в котором происходит событие (main),
                'event' => событие (OnBuildGlobalMenu),
                'class' => класс метода перехватчика (\X\Module\Admin),
                'method' => имя метода перехватчика (buildMenu)
            ],
    ];
```


### .options.php

Файл с параметрами модуля:
```php
return [
        'debug' => [
                'title' => название параметра (Отладка)
                'value' => если задан этот ключ параметр будет представлен чекбоксом (Y)
            ],
		'option_text' => [
                'title' => название параметра (Отладка)
                'default' => значение параметра если он не установлен в БД (Текст)
            ],
        'option_checkbox' => [
                'title' => название параметра (Отладка)
                'default' => значение параметра если он не установлен в БД доступно и для чекбоксов
                'value' => значение которое будет установлено если чекбокс отмечен (92)
            ],
		'option_select' => [
                'title' => название параметра (Отладка)
                'default' => значение параметра если он не установлен в БД доступно и для списков
                'options' => [ если установлен этот ключ параметр будет представлен селектом
                    1 => 'Один',
                    2 => 'Два',
                    3 => 'Три'
                ]
            ]
    ];
```